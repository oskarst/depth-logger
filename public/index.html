<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Lake Logger</title>
  <link rel="manifest" href="/manifest.webmanifest">
  <meta name="theme-color" content="#f7fafc">
  <link rel="stylesheet" href="/styles.css">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => navigator.serviceWorker.register('/service-worker.js'));
    }
  </script>
</head>
<body>
  <!-- SVG filter for blur effect -->
  <svg style="position:absolute;width:0;height:0;pointer-events:none">
    <defs>
      <filter id="weed-blur" x="-100%" y="-100%" width="300%" height="300%">
        <feGaussianBlur in="SourceGraphic" stdDeviation="8" result="blur"/>
        <feMerge>
          <feMergeNode in="blur"/>
          <feMergeNode in="blur"/>
        </feMerge>
      </filter>
    </defs>
  </svg>
  <div class="app-shell light">
    <header class="topbar">
      <div id="last-saved" class="last-saved" aria-live="polite">Last saved: ‚Äî</div>
      <div id="live-line" class="live-line">Live: waiting for GPS‚Ä¶</div>
    </header>

    <main class="content">
      <!-- PROJECT SELECTION SCREEN -->
      <section id="screen-projects" class="screen active">
        <div class="projects-wrap">
          <div class="projects-header">
            <div class="map-title">Select Project</div>
          </div>
          <div id="projects-list" class="projects-list"></div>
          <div class="projects-actions">
            <input type="text" id="new-project-input" class="project-input" placeholder="New project name..." />
            <button id="add-project-btn" class="btn small">Add</button>
          </div>
        </div>
      </section>

      <div id="logger-content" class="logger-content hidden">
        <div class="status-row">
          <span id="coord-status" class="badge">GPS: Unknown</span>
          <span id="offline-badge" class="badge secondary">Offline ready</span>
          <div class="settings-dropdown">
            <button id="settings-btn" class="btn small">Settings</button>
            <div id="settings-menu" class="settings-menu hidden">
              <button id="loc-btn" class="settings-item">Enable GPS</button>
              <button id="sync-btn" class="settings-item">Sync Data</button>
              <button id="water-level-btn" class="settings-item">Water Level</button>
              <button id="export-btn" class="settings-item">Export JSON</button>
              <button id="import-btn" class="settings-item">Import JSON</button>
            </div>
          </div>
          <input type="file" id="import-file-input" accept=".json" style="display:none" />
        </div>

      <!-- LOGGER SCREEN -->
      <section id="screen-logger" class="screen">
        <div id="pad" class="pad"></div>
      </section>

      <!-- DATA SCREEN -->
      <section id="screen-data" class="screen">
        <div class="data-wrap">
          <div class="map-header data-header">
            <div class="map-title">Data Points</div>
            <div class="data-actions">
              <button id="clear-btn" class="btn small danger" title="Clear all data">Clear</button>
            </div>
          </div>
          <div class="table-wrap">
            <table id="data-table">
              <thead>
                <tr>
                  <th>Time</th>
                  <th>Depth (m)</th>
                  <th>Tags</th>
                  <th>Lat</th>
                  <th>Lon</th>
                  <th></th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>

        <div class="data-wrap" style="margin-top:12px">
          <div class="map-header data-header">
            <div class="map-title">Fish Catches</div>
          </div>
          <div class="table-wrap">
            <table id="fish-table">
              <thead>
                <tr>
                  <th>Time</th>
                  <th>Type</th>
                  <th>Weight</th>
                  <th>Length</th>
                  <th>Lat</th>
                  <th>Lon</th>
                  <th></th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- MAP SCREEN -->
      <section id="screen-map" class="screen">
        <div class="map-wrap">
          <div class="map-header">
            <div class="map-title">Depth Map</div>
            <div class="map-layers" id="map-layers">
              <label class="layer-toggle"><input type="checkbox" id="layer-depth" checked><span>Depth</span></label>
              <label class="layer-toggle"><input type="checkbox" id="layer-contours" checked><span>Contours</span></label>
              <label class="layer-toggle"><input type="checkbox" id="layer-points" checked><span>Points</span></label>
              <label class="layer-toggle"><input type="checkbox" id="layer-weeds" checked><span>Weeds</span></label>
              <label class="layer-toggle"><input type="checkbox" id="layer-shore" checked><span>Shore</span></label>
              <label class="layer-toggle"><input type="checkbox" id="layer-fish" checked><span>Fish</span></label>
            </div>
          </div>
          <div class="map-legend" id="map-legend"></div>
          <div id="depth-map"></div>
        </div>
      </section>

      <!-- LIVE MAP SCREEN -->
      <section id="screen-livemap" class="screen">
        <div class="livemap-container">
          <div id="live-map" class="live-map"></div>
          <div id="live-pad" class="pad pad-compact"></div>
        </div>
      </section>
      </div><!-- /logger-content -->
    </main>

    <footer class="bottombar">
      <div class="bottombar-left">
        <span id="bottombar-project" class="bottombar-project">No project</span>
        <button id="change-project-btn" class="bottombar-change" title="Change project">Change</button>
      </div>
      <div class="bottombar-right">
        <button id="weeds-btn" class="weeds-btn" title="Tag last point as Has Weeds" aria-label="Has Weeds">üåø</button>
        <button id="fish-btn" class="fish-btn" title="Log caught fish" aria-label="Caught Fish">üêü</button>
        <button id="livemap-btn" class="map-btn" title="Live Map">üìç</button>
        <button id="map-btn" class="map-btn" title="Open depth map">üó∫Ô∏è</button>
        <button id="data-btn" class="map-btn" title="Open data">üìã</button>
      </div>
    </footer>
  </div>

  <template id="entry-pill-tpl">
    <div class="pill"></div>
  </template>

  <!-- Fish catch modal -->
  <div id="fish-modal" class="modal hidden">
    <div class="modal-backdrop"></div>
    <div class="modal-content">
      <div class="modal-header">
        <h3 id="fish-modal-title">Log Fish Catch</h3>
        <button class="modal-close" id="fish-modal-close">&times;</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label for="fish-type">Fish Type</label>
          <input type="text" id="fish-type" placeholder="e.g. Bass, Trout, Pike..." />
        </div>
        <div class="form-row">
          <div class="form-group">
            <label for="fish-weight">Weight (kg)</label>
            <input type="number" id="fish-weight" step="0.1" placeholder="0.0" />
          </div>
          <div class="form-group">
            <label for="fish-length">Length (cm)</label>
            <input type="number" id="fish-length" step="1" placeholder="0" />
          </div>
        </div>
        <div class="form-group">
          <label for="fish-notes">Notes</label>
          <textarea id="fish-notes" rows="2" placeholder="Lure used, conditions..."></textarea>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label for="fish-lat">Latitude</label>
            <input type="number" id="fish-lat" step="0.00001" placeholder="0.00000" />
          </div>
          <div class="form-group">
            <label for="fish-lon">Longitude</label>
            <input type="number" id="fish-lon" step="0.00001" placeholder="0.00000" />
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button id="fish-modal-delete" class="btn danger hidden">Delete</button>
        <button id="fish-modal-save" class="btn">Save</button>
      </div>
    </div>
  </div>

  <!-- Water level modal -->
  <div id="water-level-modal" class="modal hidden">
    <div class="modal-backdrop"></div>
    <div class="modal-content">
      <div class="modal-header">
        <h3>Water Level Offset</h3>
        <button class="modal-close" id="water-level-modal-close">&times;</button>
      </div>
      <div class="modal-body">
        <p style="font-size:12px;color:var(--muted);margin-bottom:12px">
          When water level changes, measure shore depth again. If original shore was 0m and now measures 0.3m, set offset to -0.3m to adjust all depths.
        </p>
        <div class="form-group">
          <label for="water-level-offset">Offset (m)</label>
          <input type="number" id="water-level-offset" step="0.1" placeholder="0.0" />
        </div>
        <div id="shore-readings-info" style="font-size:12px;color:var(--muted);margin-top:8px"></div>
      </div>
      <div class="modal-footer">
        <button id="water-level-modal-save" class="btn">Save</button>
      </div>
    </div>
  </div>

  <!-- Data point edit modal -->
  <div id="reading-modal" class="modal hidden">
    <div class="modal-backdrop"></div>
    <div class="modal-content">
      <div class="modal-header">
        <h3>Edit Data Point</h3>
        <button class="modal-close" id="reading-modal-close">&times;</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label for="reading-depth">Depth (m)</label>
          <input type="number" id="reading-depth" step="0.1" placeholder="0.0" />
        </div>
        <div class="form-row">
          <div class="form-group">
            <label class="checkbox-label">
              <input type="checkbox" id="reading-weeds" />
              <span>Has Weeds</span>
            </label>
          </div>
          <div class="form-group">
            <label class="checkbox-label">
              <input type="checkbox" id="reading-shore" />
              <span>Shore Line</span>
            </label>
          </div>
        </div>
        <div id="shore-warning" class="form-warning hidden">Shore points should have depth 0m</div>
        <div class="form-row">
          <div class="form-group">
            <label for="reading-lat">Latitude</label>
            <input type="number" id="reading-lat" step="0.00001" placeholder="0.00000" />
          </div>
          <div class="form-group">
            <label for="reading-lon">Longitude</label>
            <input type="number" id="reading-lon" step="0.00001" placeholder="0.00000" />
          </div>
        </div>
        <div id="reading-time" style="font-size:12px;color:var(--muted);margin-top:8px"></div>
      </div>
      <div class="modal-footer">
        <button id="reading-modal-delete" class="btn danger">Delete</button>
        <button id="reading-modal-save" class="btn">Save</button>
      </div>
    </div>
  </div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="https://unpkg.com/@turf/turf@6/turf.min.js"></script>
  <script src="/app.js" type="module"></script>
</body>
</html>
